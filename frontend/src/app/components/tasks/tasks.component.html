<div class="tasks-container">
  <div class="header">
    <h2>Tasks</h2>
    <p>Welcome, {{ username }}!</p>
  </div>

  <form class="create-task" #createForm="ngForm" (ngSubmit)="addTask()">
    <input
      type="text"
      name="newTitle"
      placeholder="Task Title"
      [(ngModel)]="newTitle"
      required
    />
    <input
      type="text"
      name="newDescription"
      placeholder="Task Description"
      [(ngModel)]="newDescription"
    />
    <button type="submit" [disabled]="createForm.invalid">Add Task</button>
  </form>

  <ul>
    <li *ngFor="let task of tasks" [class.done]="task.done">
      <div *ngIf="editingTask !== task" class="task-row">
        <input
          type="checkbox"
          [checked]="task.done"
          (change)="toggleTask(task)"
        />
        <span class="task-content" (click)="toggleTask(task)">
          {{ task.title }} â€” {{ task.description }}
        </span>

        <div class="actions">
          <ng-container *ngIf="!task.done; else onlyDelete">
            <button (click)="editTask(task)">Edit</button>
            <button (click)="confirmDelete(task.id!, task.title)">
              Delete
            </button>
          </ng-container>
          <ng-template #onlyDelete>
            <button
              class="delete-only"
              (click)="confirmDelete(task.id!, task.title)"
            >
              Delete
            </button>
          </ng-template>
        </div>
      </div>

      <form
        *ngIf="editingTask === task"
        class="edit-form"
        #editForm="ngForm"
        (ngSubmit)="saveEdit()"
      >
        <input
          type="text"
          name="editTitle"
          [(ngModel)]="editTitle"
          placeholder="Task Title"
          required
        />
        <input
          type="text"
          name="editDescription"
          [(ngModel)]="editDescription"
          placeholder="Task Description"
        />
        <button type="submit" [disabled]="editForm.invalid">Save</button>
        <button type="button" (click)="cancelEdit()">Cancel</button>
      </form>
    </li>
  </ul>

  <div class="bottom-container">
    <button (click)="logout()">Logout</button>
  </div>
</div>
